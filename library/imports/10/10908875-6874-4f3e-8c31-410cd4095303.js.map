{"version":3,"sources":["..\\..\\..\\..\\..\\..\\assets\\cases\\05_scripting\\11_network/assets\\cases\\05_scripting\\11_network\\NetworkCtrl.js"],"names":["i18n","require","cc","Class","extends","Component","properties","xhr","Label","xhrAB","xhrTimeout","websocket","socketIO","xhrResp","xhrABResp","xhrTimeoutResp","websocketResp","socketIOResp","wssCacert","type","Asset","default","_reconnectCount","onLoad","_wsiSendBinary","_xhrXHR","_xhrHRAB","_xhrXHRTimeout","string","t","sendXHR","sendXHRAB","sendXHRTimeout","prepareWebSocket","sendSocketIO","onDisable","wsiSendBinary","onopen","onmessage","onerror","onclose","close","rmXhrEventListener","loader","getXMLHttpRequest","streamXHREventsToLabel","open","sys","isNative","setRequestHeader","timeout","send","Uint8Array","XMLHttpRequest","self","websocketLabel","respLabel","WebSocket","nativeUrl","binaryType","evt","textKey","binary","Uint16Array","data","binaryStr","str","i","length","hexChar","toString","toUpperCase","String","fromCharCode","scheduleOnce","sendWebSocketBinary","sender","readyState","OPEN","buf","arrData","charCodeAt","buffer","warningStr","testevent","msg","tag","message","disconnection","reconnecting","io","error","sioclient","connect","_sioClient","on","bind","log","eventLabel","label","method","responseHandler","handler","response","substring","eventLabelOrigin","forEach","eventname","onreadystatechange","status","responseText"],"mappings":";;;;;;AAAA,IAAMA,OAAOC,QAAQ,MAAR,CAAb;;AAEAC,GAAGC,KAAH,CAAS;AACLC,aAASF,GAAGG,SADP;;AAGLC,gBAAY;AACRC,aAAKL,GAAGM,KADA;AAERC,eAAOP,GAAGM,KAFF;AAGRE,oBAAYR,GAAGM,KAHP;AAIRG,mBAAWT,GAAGM,KAJN;AAKRI,kBAAUV,GAAGM,KALL;;AAORK,iBAASX,GAAGM,KAPJ;AAQRM,mBAAWZ,GAAGM,KARN;AASRO,wBAAgBb,GAAGM,KATX;AAURQ,uBAAed,GAAGM,KAVV;AAWRS,sBAAcf,GAAGM,KAXT;AAYRU,mBAAW;AACPC,kBAAMjB,GAAGkB,KADF;AAEPC,qBAAS;AAFF,SAZH;AAgBRC,yBAAiB;AAhBT,KAHP;;AAsBL;AACAC,YAAQ,kBAAY;AAChB,aAAKC,cAAL,GAAsB,IAAtB;AACA,aAAKC,OAAL,GAAe,IAAf;AACA,aAAKC,QAAL,GAAgB,IAAhB;AACA,aAAKC,cAAL,GAAsB,IAAtB;;AAEA,aAAKd,OAAL,CAAae,MAAb,GAAsB5B,KAAK6B,CAAL,CAAO,gDAAP,CAAtB;AACA,aAAKf,SAAL,CAAec,MAAf,GAAwB5B,KAAK6B,CAAL,CAAO,gDAAP,CAAxB;AACA,aAAKd,cAAL,CAAoBa,MAApB,GAA6B5B,KAAK6B,CAAL,CAAO,gDAAP,CAA7B;AACA,aAAKb,aAAL,CAAmBY,MAAnB,GAA4B5B,KAAK6B,CAAL,CAAO,gDAAP,CAA5B;AACA,aAAKZ,YAAL,CAAkBW,MAAlB,GAA2B5B,KAAK6B,CAAL,CAAO,gDAAP,CAA3B;;AAEA,aAAKC,OAAL;AACA,aAAKC,SAAL;AACA,aAAKC,cAAL;AACA,aAAKC,gBAAL;AACA,aAAKC,YAAL;AACH,KAxCI;;AA0CLC,eAAW,qBAAY;AACnB,YAAIC,gBAAgB,KAAKZ,cAAzB;AACA,YAAIY,aAAJ,EAAmB;AACfA,0BAAcC,MAAd,GAAuB,IAAvB;AACAD,0BAAcE,SAAd,GAA0B,IAA1B;AACAF,0BAAcG,OAAd,GAAwB,IAAxB;AACAH,0BAAcI,OAAd,GAAwB,IAAxB;AACAJ,0BAAcK,KAAd;AACH;AACD,aAAKC,kBAAL,CAAwB,KAAKjB,OAA7B;AACA,aAAKiB,kBAAL,CAAwB,KAAKhB,QAA7B;AACA,aAAKgB,kBAAL,CAAwB,KAAKf,cAA7B;AACH,KAtDI;;AAwDLG,aAAS,mBAAY;AACjB,YAAIvB,MAAML,GAAGyC,MAAH,CAAUC,iBAAV,EAAV;AACA,aAAKC,sBAAL,CAA4BtC,GAA5B,EAAiC,KAAKA,GAAtC,EAA2C,KAAKM,OAAhD,EAAyD,KAAzD;;AAEAN,YAAIuC,IAAJ,CAAS,KAAT,EAAgB,oCAAhB,EAAsD,IAAtD;AACA,YAAI5C,GAAG6C,GAAH,CAAOC,QAAX,EAAqB;AACjBzC,gBAAI0C,gBAAJ,CAAqB,iBAArB,EAAuC,cAAvC;AACH;;AAED;AACA;AACA1C,YAAI2C,OAAJ,GAAc,KAAd,CAXiB,CAWG;;AAEpB3C,YAAI4C,IAAJ;AACA,aAAK1B,OAAL,GAAelB,GAAf;AACH,KAvEI;;AAyELwB,eAAW,qBAAY;AACnB,YAAIxB,MAAML,GAAGyC,MAAH,CAAUC,iBAAV,EAAV;AACA,aAAKC,sBAAL,CAA4BtC,GAA5B,EAAiC,KAAKE,KAAtC,EAA6C,KAAKK,SAAlD,EAA6D,MAA7D;;AAEAP,YAAIuC,IAAJ,CAAS,MAAT,EAAiB,0BAAjB;AACA;AACAvC,YAAI0C,gBAAJ,CAAqB,cAArB,EAAoC,YAApC;AACA;AACA1C,YAAI4C,IAAJ,CAAS,IAAIC,UAAJ,CAAe,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,EAAO,CAAP,EAAS,CAAT,CAAf,CAAT;AACA,aAAK1B,QAAL,GAAgBnB,GAAhB;AACH,KAnFI;;AAqFLyB,oBAAgB,0BAAY;AACxB,YAAIzB,MAAM,IAAI8C,cAAJ,EAAV;AACA,aAAKR,sBAAL,CAA4BtC,GAA5B,EAAiC,KAAKG,UAAtC,EAAkD,KAAKK,cAAvD,EAAuE,KAAvE;;AAEAR,YAAIuC,IAAJ,CAAS,KAAT,EAAgB,wBAAhB,EAA0C,IAA1C;;AAEA;AACA;AACAvC,YAAI2C,OAAJ,GAAc,IAAd,CARwB,CAQL;AACnB3C,YAAI4C,IAAJ;AACA,aAAKxB,cAAL,GAAsBpB,GAAtB;AACH,KAhGI;;AAkGL0B,sBAAkB,4BAAY;AAC1B,YAAIqB,OAAO,IAAX;AACA,YAAIC,iBAAiB,KAAK5C,SAA1B;AACA,YAAI6C,YAAY,KAAKxC,aAArB;AACA;AACA,aAAKQ,cAAL,GAAsB,IAAIiC,SAAJ,CAAc,0BAAd,EAA0C,EAA1C,EAA8C,KAAKvC,SAAL,CAAewC,SAA7D,CAAtB;AACA,aAAKlC,cAAL,CAAoBmC,UAApB,GAAiC,aAAjC;AACA,aAAKnC,cAAL,CAAoBa,MAApB,GAA6B,UAASuB,GAAT,EAAc;AACvCL,2BAAeM,OAAf,GAAyB7D,KAAK6B,CAAL,CAAO,gDAAP,CAAzB;AACH,SAFD;;AAIA,aAAKL,cAAL,CAAoBc,SAApB,GAAgC,UAASsB,GAAT,EAAc;AAC1C,gBAAIE,SAAS,IAAIC,WAAJ,CAAgBH,IAAII,IAApB,CAAb;AACA,gBAAIC,YAAY,oBAAhB;;AAEA,gBAAIC,MAAM,EAAV;AACA,iBAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAIL,OAAOM,MAA3B,EAAmCD,GAAnC,EAAwC;AACpC,oBAAIL,OAAOK,CAAP,MAAc,CAAlB,EACA;AACID,2BAAO,SAAP;AACH,iBAHD,MAKA;AACI,wBAAIG,UAAU,OAAOP,OAAOK,CAAP,EAAUG,QAAV,CAAmB,IAAnB,EAAyBC,WAAzB,EAArB;AACAL,2BAAOM,OAAOC,YAAP,CAAoBJ,OAApB,CAAP;AACH;AACJ;;AAEDJ,yBAAaC,GAAb;AACAV,sBAAU5B,MAAV,GAAmBqC,SAAnB;AACAV,2BAAeM,OAAf,GAAyB7D,KAAK6B,CAAL,CAAO,gDAAP,CAAzB;AACH,SApBD;;AAsBA,aAAKL,cAAL,CAAoBe,OAApB,GAA8B,UAASqB,GAAT,EAAc;AACxCL,2BAAeM,OAAf,GAAyB7D,KAAK6B,CAAL,CAAO,gDAAP,CAAzB;AACH,SAFD;;AAIA,aAAKL,cAAL,CAAoBgB,OAApB,GAA8B,UAASoB,GAAT,EAAc;AACxCL,2BAAeM,OAAf,GAAyB7D,KAAK6B,CAAL,CAAO,gDAAP,CAAzB;AACA;AACA;AACAyB,iBAAK9B,cAAL,GAAsB,IAAtB;AACH,SALD;;AAOA,aAAKkD,YAAL,CAAkB,KAAKC,mBAAvB,EAA4C,CAA5C;AACH,KA/II;;AAiJLA,yBAAqB,6BAASC,MAAT,EAAiB;AAClC,YAAI,CAAC,KAAKpD,cAAV,EAA0B;AAAE;AAAS;AACrC,YAAI,KAAKA,cAAL,CAAoBqD,UAApB,KAAmCpB,UAAUqB,IAAjD,EACA;AACI,iBAAKnE,SAAL,CAAekD,OAAf,GAAyB7D,KAAK6B,CAAL,CAAO,gDAAP,CAAzB;AACA,gBAAIkD,MAAM,oDAAV;;AAEA,gBAAIC,UAAU,IAAIjB,WAAJ,CAAgBgB,IAAIX,MAApB,CAAd;AACA,iBAAK,IAAID,IAAI,CAAb,EAAgBA,IAAIY,IAAIX,MAAxB,EAAgCD,GAAhC,EAAqC;AACjCa,wBAAQb,CAAR,IAAaY,IAAIE,UAAJ,CAAed,CAAf,CAAb;AACH;;AAED,iBAAK3C,cAAL,CAAoB2B,IAApB,CAAyB6B,QAAQE,MAAjC;AACH,SAXD,MAaA;AACI,gBAAIC,aAAa,gDAAjB;AACA,iBAAKxE,SAAL,CAAekD,OAAf,GAAyB7D,KAAK6B,CAAL,CAAO,iDAAP,IAA4DsD,UAArF;AACA,iBAAKT,YAAL,CAAkB,YAAY;AAC1B,qBAAKC,mBAAL;AACH,aAFD,EAEG,CAFH;AAGH;AACJ,KAvKI;;AAyKL;AACAS,eAAW,mBAASpB,IAAT,EAAe;AACtB,YAAI,CAAC,KAAKpD,QAAV,EAAoB;AAAE;AAAS;;AAE/B,YAAIyE,MAAM,KAAKC,GAAL,GAAW,+BAAX,GAA6CtB,IAAvD;AACA,aAAKpD,QAAL,CAAciD,OAAd,GAAwB7D,KAAK6B,CAAL,CAAO,iDAAP,IAA4DwD,GAApF;AACH,KA/KI;;AAiLLE,aAAS,iBAASvB,IAAT,EAAe;AACpB,YAAI,CAAC,KAAKpD,QAAV,EAAoB;AAAE;AAAS;;AAE/B,YAAIyE,MAAM,KAAKC,GAAL,GAAW,qBAAX,GAAmCtB,IAA7C;AACA,aAAK/C,YAAL,CAAkBW,MAAlB,GAA2ByD,GAA3B;AACH,KAtLI;;AAwLLG,mBAAe,yBAAW;AACtB,YAAI,CAAC,KAAK5E,QAAV,EAAoB;AAAE;AAAS;;AAE/B,YAAIyE,MAAM,KAAKC,GAAL,GAAW,gBAArB;AACA,aAAK1E,QAAL,CAAciD,OAAd,GAAwB7D,KAAK6B,CAAL,CAAO,iDAAP,IAA4DwD,GAApF;AACH,KA7LI;;AA+LLI,kBAAc,wBAAY;AACtB,YAAI,CAAC,KAAK7E,QAAV,EAAoB;AAAE;AAAS;;AAE/B,aAAKU,eAAL;AACA,YAAI+D,MAAM,KAAKC,GAAL,GAAW,mBAAX,GAAiC,KAAKhE,eAAtC,GAAwD,GAAlE;AACA,aAAKV,QAAL,CAAciD,OAAd,GAAwB7D,KAAK6B,CAAL,CAAO,iDAAP,IAA4DwD,GAApF;AACA,aAAKpE,YAAL,CAAkBW,MAAlB,GAA2B,iBAA3B;AACH,KAtMI;;AAwMLM,kBAAc,wBAAY;AACtB,YAAIoB,OAAO,IAAX;AACA,YAAI,OAAOoC,EAAP,KAAc,WAAlB,EAA+B;AAC3BxF,eAAGyF,KAAH,CAAS,iDAAT;AACA;AACH;AACD;AACA,YAAIC,YAAYF,GAAGG,OAAH,CAAW,+BAAX,EAA4C,EAAC,wBAAyB,IAA1B,EAA5C,CAAhB;AACA,aAAKC,UAAL,GAAkBF,SAAlB;;AAEA;AACA,aAAKN,GAAL,GAAWM,UAAUN,GAAV,GAAgB,aAA3B;;AAEA;AACA;AACAM,kBAAUG,EAAV,CAAa,SAAb,EAAwB,YAAW;AAC/B,gBAAI,CAACzC,KAAK1C,QAAV,EAAoB;AAAE;AAAS;;AAE/B,gBAAIyE,MAAMO,UAAUN,GAAV,GAAgB,aAA1B;AACAhC,iBAAK1C,QAAL,CAAciD,OAAd,GAAwB7D,KAAK6B,CAAL,CAAO,iDAAP,IAA4DwD,GAApF;;AAEA;AACA/B,iBAAKwC,UAAL,CAAgB3C,IAAhB,CAAqB,kBAArB;AACH,SARD;;AAUA;AACAyC,kBAAUG,EAAV,CAAa,SAAb,EAAwB,KAAKR,OAAL,CAAaS,IAAb,CAAkB,IAAlB,CAAxB;;AAEAJ,kBAAUG,EAAV,CAAa,UAAb,EAAyB,UAAU/B,IAAV,EAAgB;AACrC,gBAAI,CAACV,KAAK1C,QAAV,EAAoB;AAAE;AAAS;;AAE/BV,eAAG+F,GAAH,CAAO,+BAAP;AACA,gBAAIZ,MAAM/B,KAAKgC,GAAL,GAAW,8BAAX,GAA4CtB,IAAtD;AACAV,iBAAK1C,QAAL,CAAciD,OAAd,GAAwB7D,KAAK6B,CAAL,CAAO,iDAAP,IAA4DwD,GAApF;AACH,SAND;;AAQAO,kBAAUG,EAAV,CAAa,WAAb,EAA0B,KAAKX,SAAL,CAAeY,IAAf,CAAoB,IAApB,CAA1B;;AAEAJ,kBAAUG,EAAV,CAAa,YAAb,EAA2B,KAAKP,aAAL,CAAmBQ,IAAnB,CAAwB,IAAxB,CAA3B;;AAEAJ,kBAAUG,EAAV,CAAa,cAAb,EAA6B,KAAKN,YAAL,CAAkBO,IAAlB,CAAuB,IAAvB,CAA7B;AACH,KAjPI;;AAmPLnD,4BAAwB,gCAAWtC,GAAX,EAAgB2F,UAAhB,EAA4BC,KAA5B,EAAmCC,MAAnC,EAA2CC,eAA3C,EAA6D;AACjF,YAAIC,UAAUD,mBAAmB,UAAUE,QAAV,EAAoB;AACjD,mBAAOH,SAAS,wBAAT,GAAoCG,SAASC,SAAT,CAAmB,CAAnB,EAAsB,EAAtB,CAApC,GAAgE,KAAvE;AACH,SAFD;;AAIA,YAAIC,mBAAmBP,WAAWtE,MAAlC;AACA;AACA,SAAC,WAAD,EAAc,OAAd,EAAuB,OAAvB,EAAgC,MAAhC,EAAwC,SAAxC,EAAmD,SAAnD,EAA8D8E,OAA9D,CAAsE,UAAUC,SAAV,EAAqB;AACvFpG,gBAAI,OAAOoG,SAAX,IAAwB,YAAY;AAChCT,2BAAWtE,MAAX,GAAoB6E,mBAAmB,YAAnB,GAAkCE,SAAtD;AACA,oBAAIA,cAAc,SAAlB,EAA6B;AACzBR,0BAAMvE,MAAN,GAAe,WAAf;AACH;AACJ,aALD;AAMH,SAPD;;AASA;AACArB,YAAIqG,kBAAJ,GAAyB,YAAY;AACjC,gBAAIrG,IAAIsE,UAAJ,KAAmB,CAAnB,IAAwBtE,IAAIsG,MAAJ,IAAc,GAA1C,EAA+C;AAC3CV,sBAAMvE,MAAN,GAAe0E,QAAQ/F,IAAIuG,YAAZ,CAAf;AACH;AACJ,SAJD;AAKH,KAzQI;;AA2QLpE,wBAAoB,4BAAUnC,GAAV,EAAe;AAC/B,YAAI,CAACA,GAAL,EAAU;AACN;AACH;AACD,SAAC,WAAD,EAAc,OAAd,EAAuB,OAAvB,EAAgC,MAAhC,EAAwC,SAAxC,EAAmD,SAAnD,EAA8DmG,OAA9D,CAAsE,UAAUC,SAAV,EAAqB;AACvFpG,gBAAI,OAAOoG,SAAX,IAAwB,IAAxB;AACH,SAFD;AAGApG,YAAIqG,kBAAJ,GAAyB,IAAzB;AACH;AAnRI,CAAT","file":"NetworkCtrl.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\cases\\05_scripting\\11_network","sourcesContent":["const i18n = require('i18n');\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        xhr: cc.Label,\n        xhrAB: cc.Label,\n        xhrTimeout: cc.Label,\n        websocket: cc.Label,\n        socketIO: cc.Label,\n        \n        xhrResp: cc.Label,\n        xhrABResp: cc.Label,\n        xhrTimeoutResp: cc.Label,\n        websocketResp: cc.Label,\n        socketIOResp: cc.Label,\n        wssCacert: {\n            type: cc.Asset,\n            default: null\n        },\n        _reconnectCount: 0,\n    },\n\n    // use this for initialization\n    onLoad: function () {\n        this._wsiSendBinary = null;\n        this._xhrXHR = null;\n        this._xhrHRAB = null;\n        this._xhrXHRTimeout = null;\n        \n        this.xhrResp.string = i18n.t(\"cases/05_scripting/11_network/NetworkCtrl.js.1\");\n        this.xhrABResp.string = i18n.t(\"cases/05_scripting/11_network/NetworkCtrl.js.2\");\n        this.xhrTimeoutResp.string = i18n.t(\"cases/05_scripting/11_network/NetworkCtrl.js.2\");\n        this.websocketResp.string = i18n.t(\"cases/05_scripting/11_network/NetworkCtrl.js.3\");\n        this.socketIOResp.string = i18n.t(\"cases/05_scripting/11_network/NetworkCtrl.js.4\");\n        \n        this.sendXHR();\n        this.sendXHRAB();\n        this.sendXHRTimeout();\n        this.prepareWebSocket();\n        this.sendSocketIO();\n    },\n\n    onDisable: function () {\n        var wsiSendBinary = this._wsiSendBinary;\n        if (wsiSendBinary) {\n            wsiSendBinary.onopen = null;\n            wsiSendBinary.onmessage = null;\n            wsiSendBinary.onerror = null;\n            wsiSendBinary.onclose = null;\n            wsiSendBinary.close();\n        }\n        this.rmXhrEventListener(this._xhrXHR);\n        this.rmXhrEventListener(this._xhrHRAB);\n        this.rmXhrEventListener(this._xhrXHRTimeout);\n    },\n    \n    sendXHR: function () {\n        var xhr = cc.loader.getXMLHttpRequest();\n        this.streamXHREventsToLabel(xhr, this.xhr, this.xhrResp, 'GET');\n\n        xhr.open(\"GET\", \"https://httpbin.org/get?show_env=1\", true);\n        if (cc.sys.isNative) {\n            xhr.setRequestHeader(\"Accept-Encoding\",\"gzip,deflate\");\n        }\n\n        // note: In Internet Explorer, the timeout property may be set only after calling the open()\n        // method and before calling the send() method.\n        xhr.timeout = 10000;// 10 seconds for timeout\n\n        xhr.send();\n        this._xhrXHR = xhr;\n    },\n    \n    sendXHRAB: function () {\n        var xhr = cc.loader.getXMLHttpRequest();\n        this.streamXHREventsToLabel(xhr, this.xhrAB, this.xhrABResp, \"POST\");\n\n        xhr.open(\"POST\", \"https://httpbin.org/post\");\n        //set Content-type \"text/plain\" to post ArrayBuffer or ArrayBufferView\n        xhr.setRequestHeader(\"Content-Type\",\"text/plain\");\n        // Uint8Array is an ArrayBufferView\n        xhr.send(new Uint8Array([1,2,3,4,5]));\n        this._xhrHRAB = xhr;\n    },\n    \n    sendXHRTimeout: function () {\n        var xhr = new XMLHttpRequest();\n        this.streamXHREventsToLabel(xhr, this.xhrTimeout, this.xhrTimeoutResp, 'GET');\n\n        xhr.open(\"GET\", \"https://192.168.22.222\", true);\n\n        // note: In Internet Explorer, the timeout property may be set only after calling the open()\n        // method and before calling the send() method.\n        xhr.timeout = 5000;// 5 seconds for timeout\n        xhr.send();\n        this._xhrXHRTimeout = xhr;\n    },\n    \n    prepareWebSocket: function () {\n        var self = this;\n        var websocketLabel = this.websocket;\n        var respLabel = this.websocketResp;\n        // We should pass the cacert to libwebsockets used in native platform, otherwise the wss connection would be closed.\n        this._wsiSendBinary = new WebSocket(\"wss://echo.websocket.org\", [], this.wssCacert.nativeUrl);\n        this._wsiSendBinary.binaryType = \"arraybuffer\";\n        this._wsiSendBinary.onopen = function(evt) {\n            websocketLabel.textKey = i18n.t(\"cases/05_scripting/11_network/NetworkCtrl.js.5\");\n        };\n\n        this._wsiSendBinary.onmessage = function(evt) {\n            var binary = new Uint16Array(evt.data);\n            var binaryStr = 'response bin msg: ';\n\n            var str = '';\n            for (var i = 0; i < binary.length; i++) {\n                if (binary[i] === 0)\n                {\n                    str += \"\\'\\\\0\\'\";\n                }\n                else\n                {\n                    var hexChar = '0x' + binary[i].toString('16').toUpperCase();\n                    str += String.fromCharCode(hexChar);\n                }\n            }\n\n            binaryStr += str;\n            respLabel.string = binaryStr;\n            websocketLabel.textKey = i18n.t(\"cases/05_scripting/11_network/NetworkCtrl.js.6\");\n        };\n\n        this._wsiSendBinary.onerror = function(evt) {\n            websocketLabel.textKey = i18n.t(\"cases/05_scripting/11_network/NetworkCtrl.js.7\");\n        };\n\n        this._wsiSendBinary.onclose = function(evt) {\n            websocketLabel.textKey = i18n.t(\"cases/05_scripting/11_network/NetworkCtrl.js.8\");\n            // After close, it's no longer possible to use it again, \n            // if you want to send another request, you need to create a new websocket instance\n            self._wsiSendBinary = null;\n        };\n        \n        this.scheduleOnce(this.sendWebSocketBinary, 1);\n    },\n\n    sendWebSocketBinary: function(sender) {\n        if (!this._wsiSendBinary) { return; }\n        if (this._wsiSendBinary.readyState === WebSocket.OPEN)\n        {\n            this.websocket.textKey = i18n.t(\"cases/05_scripting/11_network/NetworkCtrl.js.9\");\n            var buf = \"Hello WebSocket中文,\\0 I'm\\0 a\\0 binary\\0 message\\0.\";\n            \n            var arrData = new Uint16Array(buf.length);\n            for (var i = 0; i < buf.length; i++) {\n                arrData[i] = buf.charCodeAt(i);\n            }\n            \n            this._wsiSendBinary.send(arrData.buffer);\n        }\n        else\n        {\n            var warningStr = \"send binary websocket instance wasn't ready...\";\n            this.websocket.textKey = i18n.t(\"cases/05_scripting/11_network/NetworkCtrl.js.10\") + warningStr;\n            this.scheduleOnce(function () {\n                this.sendWebSocketBinary();\n            }, 1);\n        }\n    },\n\n    // Socket IO callbacks for testing\n    testevent: function(data) {\n        if (!this.socketIO) { return; }\n\n        var msg = this.tag + \" says 'testevent' with data: \" + data;\n        this.socketIO.textKey = i18n.t(\"cases/05_scripting/11_network/NetworkCtrl.js.11\") + msg;\n    },\n\n    message: function(data) {\n        if (!this.socketIO) { return; }\n\n        var msg = this.tag + \" received message: \" + data;\n        this.socketIOResp.string = msg;\n    },\n\n    disconnection: function() {\n        if (!this.socketIO) { return; }\n\n        var msg = this.tag + \" disconnected!\";\n        this.socketIO.textKey = i18n.t(\"cases/05_scripting/11_network/NetworkCtrl.js.12\") + msg;\n    },\n    \n    reconnecting: function () {\n        if (!this.socketIO) { return; }\n\n        this._reconnectCount++;\n        var msg = this.tag + \" is reconnecting(\" + this._reconnectCount + \")\";\n        this.socketIO.textKey = i18n.t(\"cases/05_scripting/11_network/NetworkCtrl.js.12\") + msg;\n        this.socketIOResp.string = \"Reconnecting...\";\n    },\n\n    sendSocketIO: function () {\n        var self = this;\n        if (typeof io === 'undefined') {\n            cc.error('You should import the socket.io.js as a plugin!');\n            return;\n        }\n        //create a client by using this static method, url does not need to contain the protocol\n        var sioclient = io.connect(\"ws://tools.itharbors.com:4000\", {\"force new connection\" : true});\n        this._sioClient = sioclient;\n\n        //if you need to track multiple sockets it is best to store them with tags in your own array for now\n        this.tag = sioclient.tag = \"Test Client\";\n        \n        //register event callbacks\n        //this is an example of a handler declared inline\n        sioclient.on(\"connect\", function() {\n            if (!self.socketIO) { return; }\n\n            var msg = sioclient.tag + \" Connected!\";\n            self.socketIO.textKey = i18n.t(\"cases/05_scripting/11_network/NetworkCtrl.js.13\") + msg;\n\n            // Send message after connection\n            self._sioClient.send(\"Hello Socket.IO!\");\n        });\n\n        //example of a handler that is shared between multiple clients\n        sioclient.on(\"message\", this.message.bind(this));\n\n        sioclient.on(\"echotest\", function (data) {\n            if (!self.socketIO) { return; }\n\n            cc.log(\"echotest 'on' callback fired!\");\n            var msg = self.tag + \" says 'echotest' with data: \" + data;\n            self.socketIO.textKey = i18n.t(\"cases/05_scripting/11_network/NetworkCtrl.js.14\") + msg;\n        });\n\n        sioclient.on(\"testevent\", this.testevent.bind(this));\n\n        sioclient.on(\"disconnect\", this.disconnection.bind(this));\n\n        sioclient.on(\"reconnecting\", this.reconnecting.bind(this));\n    },\n    \n    streamXHREventsToLabel: function ( xhr, eventLabel, label, method, responseHandler ) {\n        var handler = responseHandler || function (response) {\n            return method + \" Response (30 chars): \" + response.substring(0, 30) + \"...\";\n        };\n        \n        var eventLabelOrigin = eventLabel.string;\n        // Simple events\n        ['loadstart', 'abort', 'error', 'load', 'loadend', 'timeout'].forEach(function (eventname) {\n            xhr[\"on\" + eventname] = function () {\n                eventLabel.string = eventLabelOrigin + \"\\nEvent : \" + eventname;\n                if (eventname === 'timeout') {\n                    label.string = '(timeout)';\n                }\n            };\n        });\n    \n        // Special event\n        xhr.onreadystatechange = function () {\n            if (xhr.readyState === 4 && xhr.status >= 200) {\n                label.string = handler(xhr.responseText);\n            }\n        };\n    },\n\n    rmXhrEventListener: function (xhr) {\n        if (!xhr) {\n            return;\n        }\n        ['loadstart', 'abort', 'error', 'load', 'loadend', 'timeout'].forEach(function (eventname) {\n            xhr[\"on\" + eventname] = null;\n        });\n        xhr.onreadystatechange = null;\n    }\n});\n"]}