{"version":3,"sources":["..\\..\\..\\..\\..\\..\\..\\assets\\cases\\05_scripting\\07_asset_loading\\AssetLoading/assets\\cases\\05_scripting\\07_asset_loading\\AssetLoading\\AssetLoading.js"],"names":["i18n","require","cc","Class","extends","Component","properties","showWindow","Node","loadAnimTestPrefab","Prefab","loadTips","Label","loadList","default","type","onLoad","_curType","_lastType","_curRes","_btnLabel","_audioSource","_isLoading","_urls","Audio","Txt","Texture","Font","Plist","SpriteFrame","Animation","Scene","Spine","CORS","_onRegisteredEvent","onDestroy","loader","releaseAsset","i","length","on","EventType","TOUCH_END","_onClick","bind","event","_onClear","target","name","split","_onShowResClick","textKey","t","getChildByName","getComponent","_load","url","loadCallBack","_loadCallBack","loadRes","sp","SkeletonData","ParticleAsset","load","err","res","log","removeAllChildren","AudioSource","stop","director","runScene","scene","_createNode","node","setPosition","component","addComponent","Sprite","spriteFrame","clip","play","lineHeight","string","font","ParticleSystem","file","resetSystem","prefab","instantiate","parent","loadAnim","AanimCtrl","addClip","Skeleton","skeletonData","animation","y","addChild"],"mappings":"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","file":"AssetLoading.js","sourceRoot":"..\\..\\..\\..\\..\\..\\..\\assets\\cases\\05_scripting\\07_asset_loading\\AssetLoading","sourcesContent":["const i18n = require('i18n');\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        showWindow: cc.Node,\n        loadAnimTestPrefab: cc.Prefab,\n        loadTips: cc.Label,\n        loadList: {\n            default: [],\n            type: cc.Node\n        }\n    },\n\n    // use this for initialization\n    onLoad: function () {\n        // cur load Target\n        this._curType = \"\";\n        this._lastType = \"\";\n        this._curRes = null;\n        this._btnLabel = null;\n        this._audioSource = null;\n        this._isLoading = false;\n        // add load res url\n        this._urls = {\n            Audio: \"test_assets/audio\",\n            Txt: \"test_assets/text\",\n            Texture: \"test_assets/PurpleMonster\",\n            Font: \"test_assets/font\",\n            Plist: \"test_assets/atom.plist\",\n            SpriteFrame: \"test_assets/image\",\n            Prefab: \"test_assets/prefab\",\n            Animation: \"test_assets/sprite-anim\",\n            Scene: \"test_assets/scene\",\n            Spine: \"spineboy/spineboy\",\n            CORS: \"http://tools.itharbors.com/res/logo.png\",\n        };\n        // registered event\n        this._onRegisteredEvent();\n    },\n\n    onDestroy () {\n        if (this._curRes) {\n            cc.loader.releaseAsset(this._curRes);\n        }\n    },\n\n    _onRegisteredEvent: function () {\n        for (var i = 0; i < this.loadList.length; ++i) {\n            this.loadList[i].on(cc.Node.EventType.TOUCH_END, this._onClick.bind(this));\n        }\n    },\n\n    _onClick: function (event) {\n        if (this._isLoading) {\n            return;\n        }\n\n        this._onClear();\n\n        this._curType = event.target.name.split('_')[1];\n        if (this._lastType !== \"\" && this._curType === this._lastType) {\n            this._onShowResClick(event);\n            return;\n        }\n\n        if (this._btnLabel) {\n            this._btnLabel.textKey = i18n.t(\"cases/05_scripting/07_asset_loading/AssetLoading.js.1\") + this._lastType;\n        }\n\n        this._lastType = this._curType;\n\n        this._btnLabel = event.target.getChildByName(\"Label\").getComponent(\"cc.Label\");\n\n        this.loadTips.textKey = this._curType + \" Loading....\";\n        this._isLoading = true;\n\n        this._load();\n    },\n\n    _load: function () {\n        var url = this._urls[this._curType];\n        var loadCallBack = this._loadCallBack.bind(this);\n        switch (this._curType) {\n            case 'SpriteFrame':\n                // specify the type to load sub asset from texture's url\n                cc.loader.loadRes(url, cc.SpriteFrame, loadCallBack);\n                break;\n            case 'Spine':\n                // specify the type to avoid the duplicated name from spine atlas\n                cc.loader.loadRes(url, sp.SkeletonData, loadCallBack);\n                break;\n            case 'Font':\n                cc.loader.loadRes(url, cc.Font, loadCallBack);\n                break;\n            case 'Plist':\n                cc.loader.loadRes(url, cc.ParticleAsset, loadCallBack);\n                break;\n            case 'Animation':\n            case 'Prefab':\n            case 'Scene':\n            case 'Texture':\n            case 'Txt':\n            case 'Audio':\n                cc.loader.loadRes(url, loadCallBack);\n                break;\n            case 'CORS':\n                cc.loader.load(url, loadCallBack);\n                this.loadTips.textKey = \"CORS image should report texImage2D error under WebGL and works ok under Canvas\"\n                break;\n            default:\n                cc.loader.load(url, loadCallBack);\n                break;\n        }\n    },\n\n    _loadCallBack: function (err, res) {\n        this._isLoading = false;\n        if (err) {\n            cc.log('Error url [' + err + ']');\n            return;\n        }\n        this._curRes = res;\n        if (this._curType === \"Audio\") {\n            this._btnLabel.textKey = i18n.t(\"cases/05_scripting/07_asset_loading/AssetLoading.js.2\");\n        }\n        else {\n            this._btnLabel.textKey = i18n.t(\"cases/05_scripting/07_asset_loading/AssetLoading.js.3\");\n        }\n        this._btnLabel.textKey += this._curType;\n        this.loadTips.textKey = this._curType + \" Loaded Successfully!\";\n    },\n\n    _onClear: function () {\n        this.showWindow.removeAllChildren(true);\n        if (this._audioSource && this._audioSource instanceof cc.AudioSource) {\n            this._audioSource.stop();\n        }\n    },\n\n    _onShowResClick: function (event) {\n        if (this._curType === \"Scene\") {\n            cc.director.runScene(this._curRes.scene);\n\n            return;\n        }\n        this._createNode(this._curType, this._curRes);\n    },\n\n    _createNode: function (type, res) {\n        this.loadTips.textKey = \"\";\n        var node = new cc.Node(\"New \" + type);\n        node.setPosition(0, 0);\n        var component = null;\n        switch (this._curType) {\n            case \"SpriteFrame\":\n                component = node.addComponent(cc.Sprite);\n                component.spriteFrame = res;\n                break;\n            case \"Texture\":\n            case \"CORS\":\n                component = node.addComponent(cc.Sprite);\n                component.spriteFrame = new cc.SpriteFrame(res);\n                break;\n            case \"Audio\":\n                component = node.addComponent(cc.AudioSource);\n                component.clip = res;\n                component.play();\n                this._audioSource = component;\n                this.loadTips.textKey = i18n.t(\"cases/05_scripting/07_asset_loading/AssetLoading.js.4\");\n                break;\n            case \"Txt\":\n                component = node.addComponent(cc.Label);\n                component.lineHeight = 40;\n                component.string = res;\n                break;\n            case \"Font\":\n                component = node.addComponent(cc.Label);\n                component.font = res;\n                component.lineHeight = 40;\n                component.string = \"This is BitmapFont!\";\n                break;\n            case \"Plist\":\n                component = node.addComponent(cc.ParticleSystem);\n                component.file = res;\n                component.resetSystem();\n                break;\n            case \"Prefab\":\n                var prefab = cc.instantiate(res);\n                prefab.parent = node;\n                prefab.setPosition(0, 0);\n                break;\n            case \"Animation\":\n                var loadAnim = cc.instantiate(this.loadAnimTestPrefab);\n                loadAnim.parent = node;\n                loadAnim.setPosition(0, 0);\n                var AanimCtrl = loadAnim.getComponent(cc.Animation);\n                AanimCtrl.addClip(res);\n                AanimCtrl.play(res.name);\n                break;\n            case \"Spine\":\n                component = node.addComponent(sp.Skeleton);\n                component.skeletonData = res;\n                component.animation = \"walk\";\n                node.y = -248;\n                break;\n        }\n        this.showWindow.addChild(node);\n    }\n});\n"]}